---
layout: translation
title: Pro Git 2.3 Основы Git Просмотр истории коммитов
---
<h2 id='__'>Просмотр истории коммитов</h2>

<p>После того, как вы создадите несколько коммитов, или же вы склонируете репозиторий с уже существующей историей коммитов, вы вероятно захотите оглянуться назад и узнать что же происходило с этим репозиторием. Наиболее простой и в то же время мощный инструмент для этого — команда <code>git log</code>.</p>

<p>Данные примеры используют очень простой проект названный simplegit, который я часто использую для демонстраций. Чтобы получить этот проект выполните:</p>

<pre><code>git clone git://github.com/schacon/simplegit-progit.git</code></pre>

<p>В результате выполнения <code>git log</code> в данном проекте, вы должны получить что-то вроде этого:</p>

<pre><code>$ git log
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Mon Mar 17 21:52:11 2008 -0700

    changed the version number

commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Sat Mar 15 16:40:33 2008 -0700

    removed unnecessary test code

commit a11bef06a3f659402fe7563abf99ad00de2209e6
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Sat Mar 15 10:31:28 2008 -0700

    first commit</code></pre>

<p>По умолчанию, без аргументов, <code>git log</code> выводит список коммитов созданных в данном репозитории в обратном хронологическом порядке. То есть самые последние коммиты показываются первыми. Как вы можете видеть, эта команда отображает каждый коммит вместе с его контрольной суммой SHA-1, именем и электронной почтой автора, датой создания и комментарием.</p>

<p>Существует превеликое множество параметров команды <code>git log</code> и их комбинаций, для того чтобы показать вам именно то, что вы ищете. Здесь мы покажем вам несколько наиболее часто применяемых.</p>

<p>Один из наиболее полезных параметров — это <code>-p</code>, который показывает дельту(разницу/diff) привнесенную каждым коммитом. Вы также можете использовать <code>-2</code>, что ограничит вывод до 2-х последних записей:</p>

<pre><code>$ git log -p -2
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Mon Mar 17 21:52:11 2008 -0700

    changed the version number

diff --git a/Rakefile b/Rakefile
index a874b73..8f94139 100644
--- a/Rakefile
+++ b/Rakefile
@@ -5,7 +5,7 @@ require &#39;rake/gempackagetask&#39;
 spec = Gem::Specification.new do |s|
-    s.version   =   &quot;0.1.0&quot;
+    s.version   =   &quot;0.1.1&quot;
     s.author    =   &quot;Scott Chacon&quot;

commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Sat Mar 15 16:40:33 2008 -0700

    removed unnecessary test code

diff --git a/lib/simplegit.rb b/lib/simplegit.rb
index a0a60ae..47c6340 100644
--- a/lib/simplegit.rb
+++ b/lib/simplegit.rb
@@ -18,8 +18,3 @@ class SimpleGit
     end

 end
-
-if $0 == __FILE__
-  git = SimpleGit.new
-  puts git.show
-end
\ No newline at end of file</code></pre>

<p>Этот параметр показывает ту же самую информацию плюс внесённые изменения, отображаемые непосредственно после каждого коммита. Это очень удобно для инспекций кода или для того, чтобы быстро посмотреть что происходило в результате последовательности коммитов добавленных коллегой. С командой <code>git log</code> вы также можете использовать группы суммирующих параметров. Например, если вы хотите получить некоторую краткую статистику по каждому коммиту, вы можете использовать параметр <code>--stat</code>:</p>

<pre><code>$ git log --stat
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Mon Mar 17 21:52:11 2008 -0700

    changed the version number

 Rakefile |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Sat Mar 15 16:40:33 2008 -0700

    removed unnecessary test code

 lib/simplegit.rb |    5 -----
 1 files changed, 0 insertions(+), 5 deletions(-)

commit a11bef06a3f659402fe7563abf99ad00de2209e6
Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
Date:   Sat Mar 15 10:31:28 2008 -0700

    first commit

 README           |    6 ++++++
 Rakefile         |   23 +++++++++++++++++++++++
 lib/simplegit.rb |   25 +++++++++++++++++++++++++
 3 files changed, 54 insertions(+), 0 deletions(-)</code></pre>

<p>Как видно из лога, параметр <code>--stat</code> выводит под каждым коммитом список измененных файлов, количество измененных файлов, а также количество добавленных и удаленных строк в этих файлах. Он также выводит сводную информацию в конце. Другой действительно полезный параметр — это <code>--pretty</code>. Он позволяет изменить формат вывода лога. Для вас доступны несколько предустановленных вариантов. Параметр <code>oneline</code> выводит каждый коммит в одну строку, что удобно если вы просматриваете большое количество коммитов. В дополнение к этому, параметры <code>short</code>, <code>full</code>, и <code>fuller</code> практически не меняя формат вывода позволяют выводить меньше или больше деталей соответственно:</p>

<pre><code>$ git log --pretty=oneline
ca82a6dff817ec66f44342007202690a93763949 changed the version number
085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7 removed unnecessary test code
a11bef06a3f659402fe7563abf99ad00de2209e6 first commit</code></pre>

<p>Наиболее интересный параметр — это <code>format</code>, который позволяет вам полностью создать собственный формат вывода лога. Это особенно полезно, когда вы создаете отчеты для автоматического разбора(парсинга) — поскольку вы явно задаете формат и уверены в том, что он не будет изменяться при обновлениях Git:</p>

<pre><code>$ git log --pretty=format:&quot;%h - %an, %ar : %s&quot;
ca82a6d - Scott Chacon, 11 months ago : changed the version number
085bb3b - Scott Chacon, 11 months ago : removed unnecessary test code
a11bef0 - Scott Chacon, 11 months ago : first commit</code></pre>

<p>Таблица 2-1 содержит список наиболее полезных параметров формата.</p>

<pre><code>Параметр	Описание выводимых данных
`%H`	Хеш коммита
`%h`	Сокращенный хеш коммита
`%T`	Хеш дерева
`%t`	Сокращенный хеш дерева
`%P`	Хеши родительских коммитов
`%p`	Сокращенные хеши родительских коммитов
`%an`	Имя автора
`%ae`	Электронная почта автора
`%ad`	Дата автора (формат соответствует параметру --date= )
`%ar`	Дата автора, относительная (пр. &quot;2 мес. назад&quot;)
`%cn`	Имя коммитера
`%ce`	Электронная почта коммитера
`%cd`	Дата коммитера
`%cr`	Дата коммитера, относительная
`%s`	Комментарий</code></pre>

<p>Вас может заинтересовать в чём же разница между <em>автором</em> и <em>коммитером</em>. Автор — это человек, изначально сделавший работу, тогда как коммитер — это человек, который последним применил эту работу. Так что если вы послали патч(заплатку) в проект и один из основных разработчиков применил этот патч, вы оба не будете забыты — вы как автор, а разработчик как коммитер. Мы чуть подробнее рассмотрим это различие в Главе 5.</p>

<p>Параметры oneline и format также полезны с другим параметром команды <code>log</code> — <code>--graph</code>. Этот параметр добавляет миленький ASCII граф показывающий историю ветвлений и слияний. Один из таких можно увидеть для нашей копии репозитория проекта Grit:</p>

<pre><code>$ git log --pretty=format:&quot;%h %s&quot; --graph
* 2d3acf9 ignore errors from SIGCHLD on trap
*  5e3ee11 Merge branch &#39;master&#39; of git://github.com/dustin/grit
|\
| * 420eac9 Added a method for getting the current branch.
* | 30e367c timeout code and tests
* | 5a09431 add timeout protection to grit
* | e1193f8 support for heads with slashes in them
|/
* d6016bc require time for xmlschema
*  11d191e Merge branch &#39;defunkt&#39; into local</code></pre>

<p>Мы рассмотрели только самые простые параметры форматирования вывода для <code>git log</code> — их гораздо больше. Таблица 2-2 содержит как параметры уже рассмотренные нами так и другие могущие быть полезными параметры, вместе с описанием эффекта от их использования.</p>

<pre><code>Параметр	Описание
`-p`	Выводит патч (заплатку/diff) внесенный каждым коммитом.
`--stat`	Выводит статистику по файлам измененным в каждом коммите.
`--shortstat`	Отображает только строку с changed/insertions/deletions от вывода команды `--stat`.
`--name-only`	Выводит список измененных файлов после каждого коммита.
`--name-status`	Выводит список файлов вместе с информацией о добавлении/изменении/удалении.
`--abbrev-commit`	Выводит только первые несколько символов контрольной суммы SHA-1 вместо всех 40.
`--relative-date`	Выводит дату в относительном формате (например, “2 недели назад”) вместо использования полного формата даты.
`--graph`	Выводит ASCII граф истории ветвлений и слияний рядом с выводом лога.
`--pretty`	Выводит коммиты в альтернативном формате. Параметры включают oneline, short, full, fuller, и format (где вы можете указать свой собственный формат).</code></pre>

<h3 id='___log'>Ограничение вывода команды log</h3>

<p>Кроме опций для форматирования вывода, git log имеет ряд полезных ограничительных параметров, то есть параметров, которые дают возможность отобразить часть коммитов. Вы уже видели один из таких параметров — параметр <code>-2</code>, который отображает только два последних коммита. На самом деле, вы можете задать <code>-&lt;n&gt;</code>, где <code>n</code> это количество отображаемых коммитов. На практике вам вряд ли придётся часто этим пользоваться потому, что по умолчанию Git через канал (pipe) отправляет весь вывод на pager, так что вы всегда будете видеть только одну страницу.</p>

<p>А вот, параметры ограничивающие по времени такие как <code>--since</code> и <code>--until</code> весьма полезны. Например, следующая команда выдаёт список коммитов сделаных за последние две недели:</p>

<pre><code>$ git log --since=2.weeks</code></pre>

<p>Такая команда может работать с множеством форматов — вы можете указать точную дату (“2008-01-15”) или относительную дату такую как “2 years 1 day 3 minutes ago”.</p>

<p>Вы также можете отфильтровать список коммитов так, чтобы получить те, которые удовлетворяют какому-то критерию поиска. Опция <code>--author</code> позволяет фильтровать по автору, опция <code>--grep</code> позволяет искать по ключевым словам в сообщении. (Заметим, что, если вы укажете и опцию author, и опцию grep, то будут найдены все коммиты, которые удовлетворяют первому ИЛИ второму критерию. Чтобы найти коммиты, которые удовлетворяют первому И второму критерию, следует добавить опцию <code>--all-match</code>.)</p>

<p>Последняя действительно полезная опция-фильтр для <code>git log</code> это путь. Указав имя директории или файла, вы ограничите вывод log теми коммитами, которые вносят изменения в указанные файлы. Эта опция всегда указывается последней и обычно предваряется двумя минусами (<code>--</code>), чтобы отделить пути от остальных опций.</p>

<p>В таблице 2-3 для справки приведён список часто употребляемых опций.</p>

<pre><code>Опция	Описание
`-(n)`	Показать последние n коммитов
`--since`, `--after`	Ограничить коммиты теми, которые сделаны после указанной даты.
`--until`, `--before`	Ограничить коммиты теми, которые сделаны до указанной даты.
`--author`	Показать только те коммиты, автор которых соответствует указанной строке.
`--committer`	Показать только те коммиты, коммитер которых соответствует указанной строке.</code></pre>

<p>Например, если вы хотите посмотреть из истории Git такие коммиты, которые вносят изменения в тестовые файлы, были сделаны Junio Hamano, не являются слияниями и были сделаны в октябре 2008го, вы можете выполнить что-то вроде такого:</p>

<pre><code>$ git log --pretty=&quot;%h - %s&quot; --author=gitster --since=&quot;2008-10-01&quot; \
   --before=&quot;2008-11-01&quot; --no-merges -- t/
5610e3b - Fix testcase failure when extended attribute
acd3b9e - Enhance hold_lock_file_for_{update,append}()
f563754 - demonstrate breakage of detached checkout wi
d1a43f2 - reset --hard/read-tree --reset -u: remove un
51a94af - Fix &quot;checkout --track -b newbranch&quot; on detac
b0ad11e - pull: allow &quot;git pull origin $something:$cur</code></pre>

<p>Из примерно 20 000 коммитов в истории Git, данная команда выбрала всего 6 коммитов соответствующих заданным критериям.</p>

<h3 id='_____'>Использование графического интерфейса для визуализации истории</h3>

<p>Если у вас есть желание использовать какой-нибудь графический инструмент для визуализации истории коммитов, можно попробовать распространяемую вместе с Git программу gitk, написанную на Tcl/Tk. В сущности gitk — это наглядный вариант <code>git log</code>, к тому же он принимает почти те же фильтрующие опции, что и <code>git log</code>. Если набрать в командной строке gitk находясь в проекте, вы увидете что-то наподобие Рис. 2-2.</p>

<p><center><img src="/figures/ch2/18333fig0202-tn.png"></center><br/> Рисунок 2-2. Визуализация истории с помощью gitk.</p>

<p>В верхней части окна располагается история коммитов вместе с подробным графом наследников. Просмотрщик дельт в нижней половине окна отображает изменения сделанные выбранным коммитом. Указать коммит можно с помощью щелчка мышью.</p>

<div id='nav'>
<a href='ch2-2.html'>prev</a> | <a href='ch2-4.html'>next</a>
</div>